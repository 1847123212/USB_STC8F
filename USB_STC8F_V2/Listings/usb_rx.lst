A51 MACRO ASSEMBLER  USB_RX                                                               08/13/2019 14:18:02 PAGE     1


MACRO ASSEMBLER A51 V8.2.7.0
OBJECT MODULE PLACED IN .\Objects\usb_rx.obj
ASSEMBLER INVOKED BY: C:\Program Files\Keil C\C51\C51\BIN\A51.EXE USB\Src\usb_rx.asm SET(SMALL) DEBUG PRINT(.\Listings\u
                      sb_rx.lst) OBJECT(.\Objects\usb_rx.obj) EP

LOC  OBJ            LINE     SOURCE

                       1     
                       2     
                       3     
                       4     
                       5     
                       6     
                       7     
                       8     
                       9     
                      10     NAME    USB_RX
                      11             
                      12     ?PR?usb_rx?USB_RX SEGMENT CODE
                      13             EXTRN   DATA (usb_rx_buffer, usb_rx_count, UEPF, UDRF)
                      14             EXTRN   CODE (usb_received)
                      15             EXTRN   CODE (USB_Process)
                      16             PUBLIC usb_rx
----                  17             RSEG  ?PR?usb_rx?USB_RX
0000                  18     usb_rx:
0000 7409             19             MOV A, #9
0002                  20     delay:
0002 00               21             NOP
0003 00               22             NOP
0004 00               23             NOP
0005 00               24             NOP
0006 00               25             NOP
0007 00               26             NOP
0008 14               27             DEC A
0009 70F7             28             JNZ delay
                      29             
000B 00               30             NOP
000C 00               31             NOP
000D 00               32             NOP
000E 00               33             NOP
000F 00               34             NOP
0010 00               35             NOP
                      36             
0011 00               37             NOP
                      38             
0012 7B06             39             MOV R3, #0x06
0014 7A01             40             MOV R2, #0x01
0016 7900     F       41             MOV R1, #usb_rx_buffer
0018 780C             42             MOV R0, #12
001A 7780             43             MOV @R1, #0x80
                      44             
001C 020000   F       45             LJMP bit0
                      46             
001F                  47     bit7:
001F E5B0             48             MOV A, 0xB0                           ; 1
0021 5403             49             ANL A, #0x03                          ; 1
0023 605F             50             JZ END1_RX                            ; 1/3
0025 6A               51             XRL A, R2                             ; 1
                      52     
0026 13               53             RRC A
0027 13               54             RRC A
0028 F7               55             MOV @R1, A
0029 33               56             RLC A
002A C2E1             57             CLR 0xE0.1
A51 MACRO ASSEMBLER  USB_RX                                                               08/13/2019 14:18:02 PAGE     2

002C FA               58             MOV R2, A                                                         ; 10
                      59             
002D 00               60             NOP
002E 500B             61             JNC next7
                      62             
0030 00               63             NOP
0031 00               64             NOP
0032 00               65             NOP
0033 DB0B             66             DJNZ R3, bit0                             ; 2/3
0035 120000   F       67             LCALL bit_idle                        ; 
0038 020000   F       68             LJMP bit0                             ; 3
003B                  69     next7:
003B 7B06             70             MOV R3, #0x06                                             ; 1
003D 020000   F       71             LJMP bit0
                      72             
0040                  73     bit0:
                      74     
                                     
                             
0040 00               77             NOP
                      78     
0041 E5B0             79             MOV A, 0xB0                           ; 1
0043 5403             80             ANL A, #0x03                          ; 1
0045 603D             81             JZ END1_RX                            ; 1/3
0047 6A               82             XRL A, R2                             ; 1
0048 C2E2             83             CLR 0xE0.2                            ; 1
004A 13               84             RRC A                                 ; 1
004B FA               85             MOV R2, A                             ; 1
004C 09               86             INC R1                                                            ; 1
                      87             
004D E8               88             MOV A, R0                                                         ; 1
004E 6034             89             JZ END1_RX                                                        ; 1/3
                      90             
0050 00               91             NOP
0051 500A             92             JNC next0
0053 00               93             NOP
0054 00               94             NOP                                                                       ; 15
0055 DB0A             95             DJNZ R3, bit1                         ; 2/3
0057 120000   F       96             LCALL bit_idle                        ; 
005A 020000   F       97             LJMP bit1                             ; 3
005D                  98     next0:
005D 7B06             99             MOV R3, #0x06                                             ; 1
005F 00              100             NOP
0060 00              101             NOP
0061                 102     bit1:
0061 E5B0            103             MOV A, 0xB0                           ; 1
0063 5403            104             ANL A, #0x03                          ; 1
0065 601D            105             JZ END1_RX                            ; 1/3
0067 6A              106             XRL A, R2                             ; 1
0068 C2E2            107             CLR 0xE0.2                            ; 1
006A 13              108             RRC A                                 ; 1
006B FA              109             MOV R2, A                             ; 1
006C 00              110             NOP                                                                       ; 1
                     111             
006D 00              112             NOP
006E 500D            113             JNC next1
0070 00              114             NOP
0071 00              115             NOP
0072 00              116             NOP
0073 00              117             NOP
0074 00              118             NOP
0075 DB52            119             DJNZ R3, bit2                         ; 2/3
0077 120000   F      120             LCALL bit_idle                        ; 
007A 020000   F      121             LJMP bit2                             ; 3
007D                 122     next1:
007D 7B06            123             MOV R3, #0x06                                             ; 1
A51 MACRO ASSEMBLER  USB_RX                                                               08/13/2019 14:18:02 PAGE     3

007F 00              124             NOP
0080 00              125             NOP
0081 020000   F      126             LJMP bit2
                     127             
0084                 128     END1_RX:
0084 740D            129             MOV A, #13
0086 98              130             SUBB A, R0
0087 F500     F      131             MOV usb_rx_count, A
0089 120000   F      132             LCALL usb_received
008C E500     F      133             MOV A, UDRF
008E 5500     F      134             ANL A, UEPF
0090 7001            135             JNZ goto_usb_process1
0092 22              136             RET
0093                 137     goto_usb_process1:
0093 C289            138             CLR 0x88.1
0095 D2AF            139             SETB 0xA8.7
0097 750000   F      140             MOV UEPF, #0
009A D0E0            141             POP ACC
009C D0E0            142             POP ACC
                     143             
009E 900000   F      144             MOV DPTR, #USB_Process
00A1 C082            145             PUSH DPL
00A3 C083            146             PUSH DPH
00A5 E581            147             MOV A, SP
00A7 240D            148             ADD A, #13
00A9 F581            149             MOV SP, A
                     150             
00AB D007            151             POP 0x07
00AD D006            152             POP 0x06
00AF D005            153             POP 0x05
00B1 D004            154             POP 0x04
00B3 D003            155             POP 0x03
00B5 D002            156             POP 0x02
00B7 D001            157             POP 0x01
00B9 D000            158             POP 0x00
00BB D0D0            159             POP PSW
00BD D082            160             POP DPL
00BF D083            161             POP DPH
00C1 D0F0            162             POP B
00C3 D0E0            163             POP ACC
00C5 75D000          164             MOV PSW, #0
00C8 32              165             RETI
                     166             
00C9                 167     bit2:
00C9 E5B0            168             MOV A, 0xB0                           ; 1
00CB 5403            169             ANL A, #0x03                          ; 1
00CD 60B5            170             JZ END1_RX                            ; 1/3
00CF 6A              171             XRL A, R2                             ; 1
00D0 C2E2            172             CLR 0xE0.2                            ; 1
00D2 13              173             RRC A                                 ; 1
00D3 FA              174             MOV R2, A                             ; 1
00D4 00              175             NOP
                     176             
00D5 00              177             NOP
00D6 500D            178             JNC next2
00D8 00              179             NOP
00D9 00              180             NOP
00DA 00              181             NOP
00DB 00              182             NOP
00DC 00              183             NOP
00DD DB0D            184             DJNZ R3, bit3                         ; 2/3
00DF 120000   F      185             LCALL bit_idle                        ; 
00E2 020000   F      186             LJMP bit3                             ; 3
00E5                 187     next2:
00E5 7B06            188             MOV R3, #0x06                                             ; 1
00E7 00              189             NOP
A51 MACRO ASSEMBLER  USB_RX                                                               08/13/2019 14:18:02 PAGE     4

00E8 00              190             NOP
00E9 00              191             NOP
00EA 00              192             NOP
00EB 00              193             NOP
00EC                 194     bit3:
00EC E5B0            195             MOV A, 0xB0                                                       ; 1
00EE 5403            196             ANL A, #0x03                                              ; 1
00F0 6092            197             JZ END1_RX                                                        ; 1/3
00F2 6A              198             XRL A, R2                                                         ; 1
00F3 C2E2            199             CLR 0xE0.2                            ; 1
00F5 13              200             RRC A                                                             ; 1
00F6 FA              201             MOV R2, A                                                         ; 1
00F7 00              202             NOP
                     203             
00F8 00              204             NOP
00F9 500D            205             JNC next3
00FB 00              206             NOP
00FC 00              207             NOP
00FD 00              208             NOP
00FE 00              209             NOP
00FF 00              210             NOP
0100 DB0D            211             DJNZ R3, bit4                         ; 2/3
0102 120000   F      212             LCALL bit_idle                        ; 
0105 020000   F      213             LJMP bit4                             ; 3
0108                 214     next3:
0108 7B06            215             MOV R3, #0x06                                             ; 1
010A 00              216             NOP
010B 00              217             NOP
010C 00              218             NOP
010D 00              219             NOP
010E 00              220             NOP
                     221             
010F                 222     bit4:
010F E5B0            223             MOV A, 0xB0                                                       ; 1
0111 5403            224             ANL A, #0x03                                              ; 1
0113 6040            225             JZ END2_RX                                                        ; 1/3
0115 6A              226             XRL A, R2                                                         ; 1
0116 C2E2            227             CLR 0xE0.2                            ; 1
0118 13              228             RRC A                                                             ; 1
0119 FA              229             MOV R2, A                                                         ; 1
011A 00              230             NOP
                     231     
011B 00              232             NOP
011C 500D            233             JNC next4
011E 00              234             NOP
011F 00              235             NOP
0120 00              236             NOP
0121 00              237             NOP
0122 00              238             NOP
0123 DB0D            239             DJNZ R3, bit5                         ; 2/3
0125 120000   F      240             LCALL bit_idle                        ; 
0128 020000   F      241             LJMP bit5                             ; 3
012B                 242     next4:
012B 7B06            243             MOV R3, #0x06                                             ; 1
012D 00              244             NOP
012E 00              245             NOP
012F 00              246             NOP
0130 00              247             NOP
0131 00              248             NOP
0132                 249     bit5:
0132 E5B0            250             MOV A, 0xB0                                                       ; 1
0134 5403            251             ANL A, #0x03                                              ; 1
0136 601D            252             JZ END2_RX                            ; 1/3
0138 6A              253             XRL A, R2                             ; 1
0139 C2E2            254             CLR 0xE0.2                            ; 1
013B 13              255             RRC A                                 ; 1
A51 MACRO ASSEMBLER  USB_RX                                                               08/13/2019 14:18:02 PAGE     5

013C FA              256             MOV R2, A                             ; 1
013D 00              257             NOP
                     258     
013E 00              259             NOP
013F 500D            260             JNC next5
0141 00              261             NOP
0142 00              262             NOP
0143 00              263             NOP
0144 00              264             NOP
0145 00              265             NOP
0146 DB52            266             DJNZ R3, bit6                         ; 2/3
0148 120000   F      267             LCALL bit_idle                        ; 
014B 020000   F      268             LJMP bit6                             ; 3
014E                 269     next5:
014E 7B06            270             MOV R3, #0x06                                             ; 1
0150 00              271             NOP
0151 00              272             NOP
0152 020000   F      273             LJMP bit6
                     274             
0155                 275     END2_RX:
0155 740D            276             MOV A, #13
0157 98              277             SUBB A, R0
0158 F500     F      278             MOV usb_rx_count, A
015A 120000   F      279             LCALL usb_received
015D E500     F      280             MOV A, UDRF
015F 5500     F      281             ANL A, UEPF
0161 7001            282             JNZ goto_usb_process2
0163 22              283             RET
0164                 284     goto_usb_process2:
0164 C289            285             CLR 0x88.1
0166 D2AF            286             SETB 0xA8.7
0168 750000   F      287             MOV UEPF, #0
016B D0E0            288             POP ACC
016D D0E0            289             POP ACC
                     290             
016F 900000   F      291             MOV DPTR, #USB_Process
0172 C082            292             PUSH DPL
0174 C083            293             PUSH DPH
0176 E581            294             MOV A, SP
0178 240D            295             ADD A, #13
017A F581            296             MOV SP, A
                     297             
017C D007            298             POP 0x07
017E D006            299             POP 0x06
0180 D005            300             POP 0x05
0182 D004            301             POP 0x04
0184 D003            302             POP 0x03
0186 D002            303             POP 0x02
0188 D001            304             POP 0x01
018A D000            305             POP 0x00
018C D0D0            306             POP PSW
018E D082            307             POP DPL
0190 D083            308             POP DPH
0192 D0F0            309             POP B
0194 D0E0            310             POP ACC
0196 75D000          311             MOV PSW, #0
0199 32              312             RETI
                     313             
019A                 314     bit6:
019A E5B0            315             MOV A, 0xB0                           ; 1
019C 5403            316             ANL A, #0x03                          ; 1
019E 60B5            317             JZ END2_RX                            ; 1/3
01A0 6A              318             XRL A, R2                             ; 1
01A1 C2E2            319             CLR 0xE0.2                            ; 1
01A3 13              320             RRC A                                 ; 1
01A4 FA              321             MOV R2, A                             ; 1
A51 MACRO ASSEMBLER  USB_RX                                                               08/13/2019 14:18:02 PAGE     6

01A5 18              322             DEC R0                                                            ; 1
                     323     
01A6 00              324             NOP
01A7 5010            325             JNC next6
01A9 00              326             NOP
01AA 00              327             NOP
01AB DB09            328             DJNZ R3, goto_bit7                    ; 2/3
01AD 00              329             NOP
01AE 00              330             NOP
01AF 00              331             NOP
01B0 120000   F      332             LCALL bit_idle                        ; 
01B3 020000   F      333             LJMP bit7                             ; 3
01B6                 334     goto_bit7:
01B6 020000   F      335             LJMP bit7
                     336     
01B9                 337     next6:
01B9 7B06            338             MOV R3, #0x06                                             ; 1
01BB 00              339             NOP
01BC 00              340             NOP
01BD 020000   F      341             LJMP bit7
                     342             
01C0                 343     bit_idle:
01C0 7B06            344             MOV R3, #0x06
                     345     
                                     
                             
01C2 00              348             NOP
                     349     
01C3 EA              350             MOV A, R2
01C4 B2E0            351             CPL 0xE0.0
01C6 FA              352             MOV R2, A
01C7 00              353             NOP
01C8 00              354             NOP
01C9 00              355             NOP
01CA 00              356             NOP
01CB 00              357             NOP
                     358             ;NOP
                     359             ;NOP
01CC 22              360             RET
                     361             
                     362             END
A51 MACRO ASSEMBLER  USB_RX                                                               08/13/2019 14:18:02 PAGE     7

SYMBOL TABLE LISTING
------ ----- -------


N A M E             T Y P E  V A L U E   ATTRIBUTES

?PR?USB_RX?USB_RX.  C SEG    01CDH       REL=UNIT
ACC. . . . . . . .  D ADDR   00E0H   A   
B. . . . . . . . .  D ADDR   00F0H   A   
BIT0 . . . . . . .  C ADDR   0040H   R   SEG=?PR?USB_RX?USB_RX
BIT1 . . . . . . .  C ADDR   0061H   R   SEG=?PR?USB_RX?USB_RX
BIT2 . . . . . . .  C ADDR   00C9H   R   SEG=?PR?USB_RX?USB_RX
BIT3 . . . . . . .  C ADDR   00ECH   R   SEG=?PR?USB_RX?USB_RX
BIT4 . . . . . . .  C ADDR   010FH   R   SEG=?PR?USB_RX?USB_RX
BIT5 . . . . . . .  C ADDR   0132H   R   SEG=?PR?USB_RX?USB_RX
BIT6 . . . . . . .  C ADDR   019AH   R   SEG=?PR?USB_RX?USB_RX
BIT7 . . . . . . .  C ADDR   001FH   R   SEG=?PR?USB_RX?USB_RX
BIT_IDLE . . . . .  C ADDR   01C0H   R   SEG=?PR?USB_RX?USB_RX
DELAY. . . . . . .  C ADDR   0002H   R   SEG=?PR?USB_RX?USB_RX
DPH. . . . . . . .  D ADDR   0083H   A   
DPL. . . . . . . .  D ADDR   0082H   A   
END1_RX. . . . . .  C ADDR   0084H   R   SEG=?PR?USB_RX?USB_RX
END2_RX. . . . . .  C ADDR   0155H   R   SEG=?PR?USB_RX?USB_RX
GOTO_BIT7. . . . .  C ADDR   01B6H   R   SEG=?PR?USB_RX?USB_RX
GOTO_USB_PROCESS1.  C ADDR   0093H   R   SEG=?PR?USB_RX?USB_RX
GOTO_USB_PROCESS2.  C ADDR   0164H   R   SEG=?PR?USB_RX?USB_RX
NEXT0. . . . . . .  C ADDR   005DH   R   SEG=?PR?USB_RX?USB_RX
NEXT1. . . . . . .  C ADDR   007DH   R   SEG=?PR?USB_RX?USB_RX
NEXT2. . . . . . .  C ADDR   00E5H   R   SEG=?PR?USB_RX?USB_RX
NEXT3. . . . . . .  C ADDR   0108H   R   SEG=?PR?USB_RX?USB_RX
NEXT4. . . . . . .  C ADDR   012BH   R   SEG=?PR?USB_RX?USB_RX
NEXT5. . . . . . .  C ADDR   014EH   R   SEG=?PR?USB_RX?USB_RX
NEXT6. . . . . . .  C ADDR   01B9H   R   SEG=?PR?USB_RX?USB_RX
NEXT7. . . . . . .  C ADDR   003BH   R   SEG=?PR?USB_RX?USB_RX
PSW. . . . . . . .  D ADDR   00D0H   A   
SP . . . . . . . .  D ADDR   0081H   A   
UDRF . . . . . . .  D ADDR   -----       EXT
UEPF . . . . . . .  D ADDR   -----       EXT
USB_PROCESS. . . .  C ADDR   -----       EXT
USB_RECEIVED . . .  C ADDR   -----       EXT
USB_RX . . . . . .  C ADDR   0000H   R   SEG=?PR?USB_RX?USB_RX
USB_RX_BUFFER. . .  D ADDR   -----       EXT
USB_RX_COUNT . . .  D ADDR   -----       EXT


REGISTER BANK(S) USED: 0 


ASSEMBLY COMPLETE.  0 WARNING(S), 0 ERROR(S)
